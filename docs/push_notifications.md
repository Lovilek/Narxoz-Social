# Push-уведомления

Ниже описан общий процесс настройки push-сообщений через Firebase Cloud Messaging и Celery.

1. **Получение FCM-токена на клиенте**
   - В `FCMService` токен обновляется в `onNewToken`.
   - При старте приложения токен запрашивается через `FirebaseMessaging.getInstance().token`.
   - Токен отправляется на бэкенд в `NotificationRepository.sendToken()`.
2. **Сохранение токена на сервере**
   - Бэкенд принимает токен по эндпоинту `/api/notifications/token/` и сохраняет его.
   - Для отправки push-уведомлений используется Celery‑задача, которая вызывает FCM HTTP API.
3. **Отправка уведомлений**
   - При возникновении события создаётся Celery‑таск, который берёт токены устройств и отправляет уведомление через Firebase.

Для проверки списка уведомлений доступны API:
```
GET  /api/notifications/          # получить список уведомлений
POST /api/notifications/read/<id>/  # пометить уведомление прочитанным
```
и WebSocket канал `ws://<SERVER>/ws/notify/`.
